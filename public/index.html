<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Andhrawala - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2>Andhrawala</h2>
    <div>
      <a href="/static/signup.html" class="btn btn-outline-primary btn-sm">Sign up</a>
      <a href="/static/login.html" class="btn btn-primary btn-sm">Log in</a>
    </div>
  </div>

  <hr>
  <div id="content">
    <p class="lead">Sign in to browse free movies.</p>
  </div>
</div>
<script>
  // Simple UX: if token present show movies listing
  const token = localStorage.getItem('and_token');
  if (token) {
    fetch('/api/movies?token=' + token)
      .then(r => r.json())
      .then(data => {
        if (data.error) {
          document.getElementById('content').innerHTML = '<div class="alert alert-danger">Session expired. <a href="/static/login.html">Login</a></div>';
          localStorage.removeItem('and_token');
          return;
        }
        if (!data.movies || data.movies.length === 0) {
          document.getElementById('content').innerHTML = '<p>No movies uploaded yet.</p>';
          return;
        }
        const rows = data.movies.map(m => `
          <div class="card mb-3">
            <div class="card-body">
              <h5>${m.name}</h5>
              <video width="100%" controls preload="metadata">
                <source src="${m.url}?token=${token}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          </div>`).join('');
        document.getElementById('content').innerHTML = rows + '<button id="logout" class="btn btn-danger">Logout</button>';
        document.getElementById('logout').addEventListener('click', () => {
          localStorage.removeItem('and_token'); location.reload();
        });
      })
      .catch(e => document.getElementById('content').innerText = 'Error fetching movies.');
  }
</script>
</body>
</html>
